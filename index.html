<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘äºŒç»´ç ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸµ éŸ³é¢‘äºŒç»´ç ç”Ÿæˆå™¨</h1>
        
        <!-- å®‰å…¨æç¤º -->
        <div class="security-notice">
            <h3>ğŸ”’ å®‰å…¨æç¤º</h3>
            <p>è¯·ç¡®ä¿æ‚¨çš„APIå¯†é’¥å®‰å…¨ï¼Œä¸è¦åœ¨å…¬å¼€åœºåˆåˆ†äº«ã€‚å»ºè®®ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†å¯†é’¥ä¿¡æ¯ã€‚</p>
        </div>

        <!-- é…ç½®åŒºåŸŸ -->
        <div class="config-section">
            <h3>âš™ï¸ è…¾è®¯äº‘é…ç½®</h3>
            <div class="config-grid">
                <div class="config-item">
                    <label>SecretId:</label>
                    <input type="password" id="secretId" placeholder="è¾“å…¥æ‚¨çš„SecretId">
                </div>
                <div class="config-item">
                    <label>SecretKey:</label>
                    <input type="password" id="secretKey" placeholder="è¾“å…¥æ‚¨çš„SecretKey">
                </div>
                <div class="config-item">
                    <label>å­˜å‚¨æ¡¶åç§°:</label>
                    <input type="text" id="bucket" placeholder="your-bucket-name">
                </div>
                <div class="config-item">
                    <label>åœ°åŸŸ:</label>
                    <select id="region">
                        <option value="ap-beijing">åŒ—äº¬ (ap-beijing)</option>
                        <option value="ap-shanghai">ä¸Šæµ· (ap-shanghai)</option>
                        <option value="ap-guangzhou">å¹¿å· (ap-guangzhou)</option>
                        <option value="ap-chengdu">æˆéƒ½ (ap-chengdu)</option>
                        <option value="ap-nanjing">å—äº¬ (ap-nanjing)</option>
                    </select>
                </div>
            </div>
            <div class="config-actions">
                <button onclick="loadConfig()" class="btn-secondary">åŠ è½½é…ç½®æ–‡ä»¶</button>
                <button onclick="testConnection()" class="btn-secondary">æµ‹è¯•è¿æ¥</button>
                <button onclick="loadAudioFiles()" class="btn-primary">ğŸ”„ åŠ è½½éŸ³é¢‘æ–‡ä»¶</button>
            </div>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div id="statsSection" class="stats-section" style="display: none;">
            <div class="stat-item">
                <span class="stat-number" id="totalFiles">0</span>
                <span class="stat-label">éŸ³é¢‘æ–‡ä»¶</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="totalSize">0</span>
                <span class="stat-label">æ€»å¤§å°(MB)</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="generatedQR">0</span>
                <span class="stat-label">å·²ç”ŸæˆäºŒç»´ç </span>
            </div>
        </div>

        <!-- æ“ä½œåŒºåŸŸ -->
        <div class="actions" id="actionsSection" style="display: none;">
            <button onclick="generateAllQR()" class="btn-primary">ğŸ¯ ç”Ÿæˆæ‰€æœ‰äºŒç»´ç </button>
            <button onclick="downloadAllQR()" class="btn-success">ğŸ“¥ æ‰¹é‡ä¸‹è½½äºŒç»´ç </button>
            <button onclick="clearAll()" class="btn-warning">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loadingSection" class="loading-section" style="display: none;">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨åŠ è½½éŸ³é¢‘æ–‡ä»¶...</p>
        </div>

        <!-- éŸ³é¢‘æ–‡ä»¶åˆ—è¡¨ -->
        <div id="audioList" class="audio-list"></div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cos-js-sdk-v5@1.4.20/dist/cos-js-sdk-v5.min.js"></script>
    
    <!-- å¤‡ç”¨äºŒç»´ç åº“åŠ è½½æ£€æŸ¥ -->
    <script>
        // æ£€æŸ¥QRCodeåº“æ˜¯å¦åŠ è½½æˆåŠŸï¼Œå¦‚æœå¤±è´¥åˆ™åŠ è½½å¤‡ç”¨åº“
        window.addEventListener('load', function() {
            if (typeof QRCode === 'undefined') {
                console.log('ä¸»è¦QRCodeåº“åŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨åº“...');
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js';
                script.onload = function() {
                    console.log('å¤‡ç”¨QRCodeåº“åŠ è½½æˆåŠŸ');
                    // å¦‚æœæ˜¯è€ç‰ˆæœ¬çš„åº“ï¼Œéœ€è¦å…¼å®¹å¤„ç†
                    if (typeof QRCode === 'undefined' && typeof qrcode !== 'undefined') {
                        window.QRCode = {
                            toCanvas: function(canvas, text, callback) {
                                try {
                                    const qr = qrcode(0, 'M');
                                    qr.addData(text);
                                    qr.make();
                                    
                                    const ctx = canvas.getContext('2d');
                                    const size = 256;
                                    canvas.width = size;
                                    canvas.height = size;
                                    
                                    const moduleCount = qr.getModuleCount();
                                    const cellSize = size / moduleCount;
                                    
                                    ctx.fillStyle = '#ffffff';
                                    ctx.fillRect(0, 0, size, size);
                                    
                                    ctx.fillStyle = '#000000';
                                    for (let row = 0; row < moduleCount; row++) {
                                        for (let col = 0; col < moduleCount; col++) {
                                            if (qr.isDark(row, col)) {
                                                ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
                                            }
                                        }
                                    }
                                    
                                    if (callback) callback();
                                } catch (error) {
                                    console.error('äºŒç»´ç ç”Ÿæˆå¤±è´¥:', error);
                                    if (callback) callback(error);
                                }
                            }
                        };
                    }
                };
                script.onerror = function() {
                    console.error('æ‰€æœ‰QRCodeåº“éƒ½åŠ è½½å¤±è´¥');
                    alert('äºŒç»´ç åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•');
                };
                document.head.appendChild(script);
            } else {
                console.log('QRCodeåº“åŠ è½½æˆåŠŸ');
            }
        });
    </script>
    
    <!-- é…ç½®æ–‡ä»¶ (å¦‚æœå­˜åœ¨) -->
    <script src="config.local.js" onerror="console.log('é…ç½®æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥é…ç½®ä¿¡æ¯')"></script>
    
    <!-- ä¸»è¦é€»è¾‘ -->
    <script src="js/app.js"></script>
</body>
</html> 
